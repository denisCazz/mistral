---
const navItems = [
  { name: 'Home', href: '/' },
  { name: 'Servizi', href: '/servizi' },
  { name: 'Lavori', href: '/lavori' },
  { name: 'Partners', href: '/partners' },
  { name: 'Contatti', href: '/contatti' },
];

const currentPath = Astro.url.pathname;
---
<header class="pointer-events-none fixed inset-x-0 top-6 z-50 flex justify-center px-4">
  <div class="pointer-events-auto w-full max-w-6xl">
    <nav class="flex items-center justify-between rounded-2xl border border-black/10 bg-white/95 px-5 py-3 shadow-lg shadow-black/5 backdrop-blur">
      <a
        href="/"
        class="flex items-center gap-3 text-left"
        title="Mistral Impianti SRL - Servizi di impiantistica industriale"
      >
        <span class="flex h-12 w-12 items-center justify-center rounded-full bg-black text-white">
          <img src="/logo.jpg" alt="Mistral Impianti Logo" class="h-12 w-12 rounded-full object-cover" loading="lazy" />
        </span>
        <span class="hidden sm:flex flex-col leading-tight">
          <span class="text-sm uppercase tracking-[0.2em] text-black">Mistral Impianti</span>
          <span class="text-base font-semibold text-black">Soluzioni impiantistiche tecnologiche</span>
        </span>
      </a>

      <div class="hidden items-center gap-1 lg:flex">
        {navItems.map((item) => {
          const isActive = currentPath === item.href || (item.href !== '/' && currentPath.startsWith(item.href));
          return (
            <a
              href={item.href}
              class={`rounded-full px-4 py-2 text-sm font-medium transition-colors duration-200 ${
                isActive ? 'bg-black text-white' : 'text-black hover:bg-black/5'
              }`}
              aria-current={isActive ? 'page' : undefined}
            >
              {item.name}
            </a>
          );
        })}
      </div>

      <button
        id="mobile-menu-button"
        class="lg:hidden inline-flex h-12 w-12 items-center justify-center rounded-full border border-black/10 bg-white text-black transition-colors hover:bg-black/5"
        aria-label="Apri il menu"
        aria-expanded="false"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>
    </nav>

    <div
      id="mobile-menu"
      class="mt-4 hidden flex-col gap-2 rounded-2xl border border-black/10 bg-white/95 p-4 text-black shadow-lg shadow-black/5 backdrop-blur lg:hidden"
    >
      {navItems.map((item) => {
        const isActive = currentPath === item.href || (item.href !== '/' && currentPath.startsWith(item.href));
        return (
          <a
            href={item.href}
            class={`flex items-center justify-between rounded-xl px-4 py-3 text-sm font-medium transition ${
              isActive ? 'bg-black text-white' : 'hover:bg-black/5'
            }`}
            aria-current={isActive ? 'page' : undefined}
          >
            <span>{item.name}</span>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-4 w-4"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 5l7 7-7 7" />
            </svg>
          </a>
        );
      })}
    </div>
  </div>
</header>

<script>
  const button = document.getElementById('mobile-menu-button');
  const menu = document.getElementById('mobile-menu');

  if (button && menu) {
    button.addEventListener('click', () => {
      const isOpen = menu.classList.toggle('hidden');
      button.setAttribute('aria-expanded', (!isOpen).toString());
    });
  }
</script>
